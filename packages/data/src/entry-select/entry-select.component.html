<div class="ec-entry-select" *ngIf="selection">
  <div class="ec-select" [class.is-solo]="solo" [class.is-dirty]="selection.items.length" (click)="activate()">
    <span class="ec-select__placeholder" *ngIf="!selection.items.length">
      {{placeholder||defaultPlaceholder()}}
    </span>
    <span class="ec-select-selected" (click)="clickItem(selection.items[0],$event)" *ngIf="selection.items.length&&solo">
      {{selection.items[0].display()}}
      <a (click)="removeItem(selection.items[0],false,$event)">&times;</a>
    </span>
    <ul class="ec-select-selection" *ngIf="selection.items.length&&!solo" dndDropzone (dndDrop)="onDrop($event)">
      <li [dndDisableIf]="solo||config?.disableDrag" [class.is-dragged]="selected===dragged" [class.is-draggable]="solo||!config?.disableDrag"
        dndEffectAllowed="move" [dndDraggable]="selected" *ngFor="let selected of selection?.items" (dndStart)="onDragStart(selected,$event)"
        (dndCanceled)="cancelDrag(selected,$event)" (dndEnd)="cancelDrag(selected,$event)">
        <span class="ec-select-selected" (click)="!solo&&editItem(selected,$event)">
          {{selected.display()}}
          <a (click)="removeItem(selected,false,$event)">&times;</a>
        </span>
      </li>
      <li dndPlaceholderRef>
        <!-- TODO change to width of dragged element -->
        <div class="drag-placeholder" style="width: 48px;"></div>
      </li>
    </ul>
    <!-- Dropdown -->
    <ec-pop [ngClass]="config?.nestedPopClass || 'ec-select-options'" #dropdown *ngIf="!config.disableSelect">
      <!-- [active]="config?.nestedPopActive" [visible]="config?.nestedPopVisible" -->
      <ec-list [items]="models" *ngIf="!model" [config]="modelDropdownConfig" (columnClicked)="selectModel($event)"></ec-list>
      <a (click)="switchModel($event)" *ngIf="model">{{model}}</a>
      <ec-resource-list #entryList [relation]="'model.'+model" [api]="sdk.api" *ngIf="model" [config]="dropdownConfig" [selection]="selection"
        (click)="$event.preventDefault();$event.stopPropagation()" (columnClicked)="select($event)"></ec-resource-list><!-- &&selection&&dropdown.active -->
    </ec-pop>
  </div>
  <div *ngIf="model">
    <!-- Fully fledged entryListPop -->
    <!-- [config]="config" -->
    <ec-entry-list-pop [config]="{disableHeader:true,hidePagination:true}" [model]="model" [ngClass]="getPopClass()" class="ec-entry-list-pop"
      [selection]="selection" #entryListPop></ec-entry-list-pop>
    <ec-resource-delete-pop [question]="'entry.select.delete.question' | symbol" #confirmDelete></ec-resource-delete-pop>
    <!--[config]="config"  -->
    <ec-entry-pop #entryPop [model]="model" [ngClass]="getPopClass()" (submitted)="formSubmitted($event)" (deleted)="removeItem($event,true)"></ec-entry-pop>
    <nav class="ec-entry-select__controls">
      <a (click)="editItem(selection.items[0],$event)" class="btn btn_clear" *ngIf="solo&&!config.disableCreatePop&&hasMethod('put')&&!selection.isEmpty()">
        <ec-icon name="pencil"></ec-icon>
      </a>
      <a (click)="entryListPop.show()" class="btn btn_clear" *ngIf="!config.disableListPop&&hasMethod('get')">
        <ec-icon name="list-bullets"></ec-icon>
      </a>
      <a (click)="entryPop.create()" class="btn btn_clear" *ngIf="!config.disableCreatePop&&hasMethod('post')&&(!solo||selection.isEmpty())">
        <ec-icon name="add"></ec-icon>
      </a>
    </nav>
  </div>
</div>