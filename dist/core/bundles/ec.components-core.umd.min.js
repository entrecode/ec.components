!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports,require("rxjs/operators"),require("rxjs")):"function"==typeof define&&define.amd?define("@ec.components/core",["exports","rxjs/operators","rxjs"],i):i((t.ec=t.ec||{},t.ec.components=t.ec.components||{},t.ec.components.core={}),t.rxjs.operators,t.rxjs)}(this,function(t,s,r){"use strict";var i=function(){function t(t){void 0===t&&(t=[]);var i=this;this.update=new r.Subject,this.update$=this.update.asObservable(),this.items=[],t.forEach(function(t){i.items.push(t)})}return t.prototype.index=function(t){return this.items.indexOf(t)},t.prototype.has=function(t){return-1!==this.index(t)},t.prototype.hasAll=function(t){var e=this;return void 0===t&&(t=[]),null!==t&&t.reduce(function(t,i){return t&&e.has(i)},!0)},t.prototype.add=function(t,i,e){if(void 0===e&&(e=!0),i&&this.has(t))return!1;this.items.push(t),e&&this.update.next(this)},t.prototype.addAll=function(t,i,e){var o=this;void 0===t&&(t=[]),void 0===i&&(i=!1),void 0===e&&(e=!0);var n=this.items.length;t.forEach(function(t){o.add(t,i,!1)}),this.items.length>n&&e&&this.update.next(this)},t.prototype.remove=function(t,i){if(void 0===i&&(i=!0),!this.has(t))return!1;this.items.splice(this.index(t),1),i&&this.update.next(this)},t.prototype.removeAll=function(t,i){var e=this;void 0===i&&(i=!0);var o=this.items.length;t?t.forEach(function(t){e.remove(t,!1)}):this.items.length=0,this.items.length<o&&i&&this.update.next(this)},t.prototype.toggle=function(t,i){void 0===i&&(i=!0),this.has(t)?this.remove(t,i):this.add(t,i)},t.prototype.replaceWith=function(t,i){void 0===i&&(i=!0),this.items&&this.items.length&&this.removeAll(undefined,!1),t.length&&this.addAll(t,!1,!1),i&&this.update.next(this)},t.prototype.isEmpty=function(){return 0===this.items.length},t.prototype.move=function(t,i,e){void 0===e&&(e=!0),this.has(t)&&this.items.indexOf(t)!==i&&(this.items.splice(i,0,this.items.splice(this.items.indexOf(t),1)[0]),e&&this.update.next(this))},t}(),f=function(){function t(t,i){this.values=[],this["class"]="",i&&Object.assign(this,i),Object.assign(this,{property:t}),this.id=this.property+"_"+Date.now()}return t.prototype.getPlaceholder=function(){return this.placeholder||this.label||this.property},t.prototype.getColumns=function(){return(this.columns||12)+"-sm"},t}(),e=function(){function t(){this.config={}}return t.prototype.configure=function(t,i,e){return this.config[t]||(this.config[t]={}),e?(this.config[t][i]||(this.config[t][i]={}),Object.assign(this.config[t][i],e),this):this.config[t][i]},t}(),o=function(t,i){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])})(t,i)};function c(t,i){function e(){this.constructor=t}o(t,i),t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)}function h(t,i){var e="function"==typeof Symbol&&t[Symbol.iterator];if(!e)return t;var o,n,s=e.call(t),r=[];try{for(;(void 0===i||0<i--)&&!(o=s.next()).done;)r.push(o.value)}catch(f){n={error:f}}finally{try{o&&!o.done&&(e=s["return"])&&e.call(s)}finally{if(n)throw n.error}}return r}var l=function(){function t(t,i){void 0===i&&(i={}),this.body=t,this.config=i||this.generateConfig()}return t.prototype.generateConfig=function(){var i=this,e={fields:{}};return this.body===undefined||this.getProperties().forEach(function(t){e.fields[t]={view:typeof i.body[t],type:typeof i.body[t]},"object"===e.fields[t].view&&Array.isArray(i.body[t])&&(e.fields[t].view="array",e.fields[t].values=i.body[t])}),e},t.prototype.getBody=function(){return this.body},t.prototype.hasBody=function(){return this.body!==undefined&&null!==this.body},t.prototype.clear=function(){delete this.body},t.prototype.useConfig=function(t){this.config=Object.assign(this.config,t)},t.prototype.getConfig=function(){return this.config},t.prototype.getProperties=function(){return this.body&&"object"==typeof this.body?Object.keys(this.body):"object"!=typeof this.body?[this.config&&this.config.title?this.config.title:"body"]:[]},t.prototype.id=function(){if(!this.config.identifier)throw new Error("cannot get id of item without identifier!");return this.resolve(this.config.identifier)},t.prototype.resolve=function(t){if(this.hasBody()){if("object"!=typeof this.body)return this.body;if(!this.config)return t?this.body[t]:this.body;if(!t)return this.config.resolve?this.config.resolve(this.body):this.body;if(this.config.fields&&this.config.fields[t]&&this.config.fields[t].resolve)return this.config.fields[t].resolve(this.body,this,t);if(!this.config.resolve)return this.body[t];var i=this.config.resolve(this.body);return i?i[t]:null}},t.prototype.transform=function(t,i,e,o){if(void 0===e&&(e=this.resolve(i)),void 0===o&&(o=this.resolve(i)),this.hasBody())return this.config.fields&&this.config.fields[i]&&this.config.fields[i][t]?this.config.fields[i][t](e,this.body,i):o},t.prototype.group=function(t){return this.transform("group",t)},t.prototype.classes=function(t){return t?this.transform("classes",t,this.resolve(t),"")||"":this.config&&this.config.classes?this.config.classes(this):""},t.prototype.display=function(t){return t?this.transform("display",t):this.transform("display",this.config.label||this.getProperties()[0])},t.prototype.sort=function(t){return this.transform("sort",t)},t.prototype.pickWriteOnly=function(e){var o=this;return void 0===e&&(e=this.body),Object.assign.apply(Object,function n(){for(var t=[],i=0;i<arguments.length;i++)t=t.concat(h(arguments[i]));return t}([{}],Object.keys(e).map(function(t){var i;if(!o.config.fields[t].readOnly)return(i={})[t]=e[t],i}).filter(function(t){return!!t})))},t.prototype.isImmutableProperty=function(t){return this.config&&this.config.fields&&this.config.fields[t]&&"function"==typeof this.config.fields[t].immutable?this.config.fields[t].immutable(this):this.config.fields[t].immutable},t.prototype.deleteImmutableProperties=function(i){var e=this;void 0===i&&(i=this.body),Object.keys(this.config.fields).forEach(function(t){i.hasOwnProperty(t)&&e.isImmutableProperty(t)&&delete i[t]})},t.prototype.serialize=function(e,t){var o=this;return void 0===t&&(t=!1),t&&(e=this.pickWriteOnly(e)),this.deleteImmutableProperties(e),Object.keys(e).map(function(t){var i;Object.assign(e,((i={})[t]=o.transform("serialize",t,e[t]),i))}),e},t.prototype.save=function(t){var i=this;return void 0===t&&(t=this.body),this.config.onSave?Promise.resolve(this.config.onSave(this,t)).then(function(t){return i.body=t,i}):(this.body=Object.assign(this.resolve()||{},t),Promise.resolve(this))},t.prototype.action=function(t,i){i.preventDefault(),i.stopPropagation(),i.stopImmediatePropagation(),this.config.fields[t].action&&this.config.fields[t].action(this,t)},t}(),n=function(o){function t(t,i){var e=o.call(this,t,i)||this;return e.fields=[],e.config&&e.config.fields&&Object.keys(e.config.fields).forEach(function(t){e.fields.push(new f(t,e.config.fields[t]))}),e}return c(t,o),t.prototype.createField=function(t,i){if(i&&t){if(!this.config.fields[t]){this.config.fields[t]=i;var e=new f(t,this.config.fields[t]);return this.fields=this.fields.concat([e]),e}console.error('cannot create field "',t,'". Property name already taken.')}},t.prototype.getField=function(i){return this.fields.find(function(t){return t.property===i})},t.prototype.getValue=function(t){return!this.body&&this.config.fields&&this.config.fields[t]?Array.isArray(this.config.fields[t].prefill)?this.config.fields[t].prefill.slice(0):"object"==typeof this.config.fields[t].prefill?Object.assign({},this.config.fields[t].prefill):this.config.fields[t].prefill:this.resolve(t)},t.prototype.isEditing=function(){return!!this.getBody()},t.prototype.isCreating=function(){return!this.isEditing()},t}(l),a=function(){function t(t,i){this.change=new r.Subject,this.change$=this.change.asObservable(),this.config={page:1,size:25},Object.assign(this.config,t),Object.assign(this.config,{availableSizes:Array.from(new Set([this.config.size].concat(this.config.availableSizes||[10,25,50,100],[this.config.size]).sort(function(t,i){return t-i})))}),i&&this.setTotal(i)}return t.prototype.getPage=function(){return this.config.page},t.prototype.getPages=function(){return this.pages?this.pages.length:0},t.prototype.next=function(){this.isLast()||(this.config.page+=1,this.load())},t.prototype.prev=function(){this.isFirst()||(this.config.page-=1,this.load())},t.prototype.setTotal=function(t){this.total=t,this.pages=new Array(Math.ceil(this.total/this.config.size)),1!==this.config.page&&this.config.page>this.pages.length&&(this.config.page=this.pages.length||1,this.load())},t.prototype.load=function(t){t&&Object.assign(this.config,t),this.change.next(this.config)},t.prototype.select=function(t,i){void 0===i&&(i=!1),t===this.config.page||i?this.config.page=t:this.load({page:t})},t.prototype.first=function(){this.load({page:1})},t.prototype.last=function(){if(!this.pages)throw new Error("Cannot load last page without knowing the item count.\n        Call setTotal(itemCount) before loading.");this.load({page:this.pages.length})},t.prototype.isActive=function(t){return this.config.page===t},t.prototype.isFirst=function(){return 1===this.config.page},t.prototype.isLast=function(){return!this.pages||this.config.page===this.pages.length},t.prototype.slice=function(t){return t.slice((this.config.page-1)*this.config.size,this.config.page*this.config.size)},t.prototype.params=function(){return{page:this.getPage(),pages:this.getPages(),total:this.total,from:(this.getPage()-1)*this.config.size+1,to:Math.min(this.getPage()*this.config.size,this.total),size:this.config.size,availableSizes:this.config.availableSizes}},t.prototype.updateSize=function(t){t&&this.load({size:t,page:1})},t}(),u=new Intl.Collator(undefined,{numeric:!0,sensitivity:"base"});function p(t,i){return u.compare(t,i)}function g(t,i){return t-i}function d(t,i){return t?-1:1}var y=function(){function t(){}return t.getAlgorithm=function(t,e){if(t.length)if(!e||t.reduce(function(t,i){return t&&i.sort(e)!==undefined},!0)){var i=t.map(function(t){return typeof t.sort(e)}).filter(function(t,i,e){return e.indexOf(t)===i});if(1<i.length)console.warn("cannot sort items because they contain multiple types:",i);else{if(this.sortType[i[0]])return this.sortType[i[0]];console.warn("cannot sort items because no algorithm was found for type",i[0])}}else console.warn('cannot sort property "'+e+'" because not all items have that property',t)},t.sort=function(t,e,i){var o=this.getAlgorithm(t,e);o&&(t.sort(function(t,i){return e?o(t.sort(e),i.sort(e)):o(t.resolve(),i.resolve())}),i&&t.reverse())},t.sortType={string:p,number:g,"boolean":d},t}(),v=function(n){function t(t,i,e){void 0===i&&(i={});var o=n.call(this,[])||this;return o.groups=[],o.page=[],o.change=new r.Subject,o.change$=o.change.asObservable(),t&&n.prototype.addAll.call(o,t.map(function(t){return new l(t,Object.assign({},i))}),!1,!1),o.config=Object.assign({page:1,maxColumns:8},i||{}),o.fields=o.getFields(),o.hideOverflowFields(),o.pagination=e||new a(o.config,o.items.length),o.change$.subscribe(function(){o.pagination.select(o.config.page||1,!0)}),e||(o.pagination.change$.pipe(s.debounceTime(200)).subscribe(function(t){return o.load(t)}),o.load()),o}return c(t,n),Object.defineProperty(t.prototype,"display",{get:function(){return this.config&&this.config.display?this.config.display(this.items):this.items},enumerable:!0,configurable:!0}),t.prototype.load=function(t){t&&Object.assign(this.config,t),this.page=this.pagination.slice(this.items),this.groupBy(this.config.sortBy),this.change.next(this)},t.prototype.add=function(t,i,e){return void 0===e&&(e=!0),t.useConfig(this.config),n.prototype.add.call(this,t,i,e)},t.prototype.getFields=function(){var i=this;if(this.config&&this.config.fields)return Object.keys(this.config.fields).filter(function(t){return!1!==i.config.fields[t].list}).map(function(t){return new f(t,i.config.fields[t])});var e=[];return this.items.forEach(function(t){t.getProperties().forEach(function(i){e.find(function(t){return t.property===i})||e.push(new f(i,{type:typeof t.resolve(i)}))})}),e},t.prototype.toggleVisibility=function(t){t.hideInList=!t.hideInList,this.change.next(this)},t.prototype.hideOverflowFields=function(){var e=this;this.config&&this.config.maxColumns&&this.fields.filter(function(t){return!t.hideInList}).forEach(function(t,i){i>=e.config.maxColumns&&t.hideInList===undefined&&(t.hideInList=!0)})},t.prototype.id=function(e){if(e===undefined)throw new Error('cannot get item with identifier "'+e+'"');return this.items.find(function(t,i){return!!t.config.identifier&&t.id()===e})||this.items[e]},t.prototype.filter=function(i,e,t){var o;void 0===e&&(e=""),void 0===t&&(t="exact"),this.config.filter=((o={})[i]=e,o),null!==e?this.page=this.items.filter(function(t){return t.resolve(i).toLowerCase().includes(e.toLowerCase())}).slice(0,this.config.size||100):this.load()},t.prototype.clearFilter=function(t){if(t)return this.filter(t,null);this.load({page:1,filter:{}})},t.prototype.isEmptyFilter=function(t){return""===t||null===t||t===undefined||Array.isArray(t)&&!t.length},t.prototype.isFiltered=function(t){var i=this;return!!this.config.filter&&(t?!this.isEmptyFilter(this.config.filter[t]):0<Object.keys(this.config.filter).filter(function(t){return!i.isEmptyFilter(i.config.filter[t])}).length)},t.prototype.getFilterValue=function(t){return t||(t=this.config.label),this.config.filter&&t?this.config.filter[t]:undefined},t.prototype.sortProperty=function(t,i){t!==this.config.sortBy?(delete this.config.desc,this.config.sortBy=t):this.config.desc&&delete this.config.sortBy,this.config.desc=this.config.desc===undefined?i||!1:!this.config.desc},t.prototype.isSorted=function(t,i){return void 0===i?this.config.sortBy===t:this.config.sortBy===t&&this.config.desc===i},t.prototype.toggleSort=function(t,i){this.sortProperty(t,i),y.sort(this.items,t,this.config.desc),this.load(this.config)},t.prototype.toggleSelectMode=function(){this.config=Object.assign({},this.config,{selectMode:!this.config.selectMode}),this.change.next(this)},t.prototype.groupBy=function(e){var o=this;delete this.groups;var n=this.pagination?this.pagination.getPage():0;if(e&&this.config.fields&&this.config.fields[e]&&this.config.fields[e].group){var s=[];this.page.forEach(function(t){var i=t.group(e);s.find(function(t){return t.value===i})||s.push({value:i,page:n,property:o.config.sortBy,desc:o.config.desc})}),this.groups=s}else this.groups=[{page:n,sortBy:this.config.sortBy,desc:this.config.desc}]},t.prototype.trackItem=function(t,i){return t},t.prototype.sortableFields=function(){return this.fields.filter(function(t){return t.sortable})},t.prototype.isOverTheMax=function(t){return this.fields.filter(function(t){return!t.hideInList}).indexOf(t)>=this.config.maxColumns},t}(i),m=function(i){function t(){return null!==i&&i.apply(this,arguments)||this}return c(t,i),t.prototype.select=function(t,i){void 0===i&&(i=this.config.solo),i?(this.removeAll(),this.add(t)):this.add(t,!0)},t.prototype.index=function(i){return this.config.identifier?this.items.indexOf(this.id(i.resolve(this.config.identifier))):this.items.indexOf(this.items.find(function(t){return t.resolve()===i.resolve()}))},t.prototype.has=function(t){return i.prototype.has.call(this,t)||-1!==this.index(t)},t.prototype.toggle=function(t,i,e){if(void 0===i&&(i=this.config.solo),void 0===e&&(e=!0),t)if(this.has(t))if(i){if(1<this.items.length)return this.replaceWith([t],e);this.removeAll()}else this.remove(t,e);else{if(i)return this.replaceWith([t],e);this.add(t,e)}else console.warn("toggle malicious item",t)},t.prototype.toggleAll=function(i,e,t){var o=this;return i=i||[],e||t||!this.hasAll(i)?(i.forEach(function(t){e?o.toggle(t,o.config.solo,!1):o.hasAll(i)||o.add(t,!0,!1)}),this.update.next(this)):this.removeAll(i),this},t.prototype.flipAll=function(t){return this.toggleAll(t,!0)},t.prototype.getValue=function(t){var i=this;void 0===t&&(t=this.config.solo);var e=this.items.map(function(t){return i.config.identifier?t.id():t.resolve()});return t?e.length?e[0]:null:e},t}(v);t.Collection=i,t.Field=f,t.Config=e,t.Form=n,t.Item=l,t.List=v,t.Pagination=a,t.Selection=m,t.sortString=p,t.sortNumber=g,t.sortBoolean=d,t.Sorter=y,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ec.components-core.umd.min.js.map